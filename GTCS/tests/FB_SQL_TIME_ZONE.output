create database "WHERE_GDB:time_zone.fdb";

---


set time zone '00:00';


select cast('01:23:45' as time with time zone),
       cast('2018-01-01 01:23:45' as timestamp with time zone),
       extract(timezone_hour from cast('01:23:45' as time with time zone)),
       extract(timezone_minute from cast('01:23:45' as time with time zone)),
       extract(timezone_hour from cast('2018-01-01 01:23:45' as timestamp with time zone)),
       extract(timezone_minute from cast('2018-01-01 01:23:45' as timestamp with time zone)),
       cast(cast('01:23:45' as time with time zone) as time),
       cast(cast('2018-01-01 01:23:45' as timestamp with time zone) as timestamp)
  from rdb$database;

                                          CAST                                                      CAST EXTRACT EXTRACT EXTRACT EXTRACT          CAST                      CAST 
============================================== ========================================================= ======= ======= ======= ======= ============= ========================= 
01:23:45.0000 +00:00                           2018-01-01 01:23:45.0000 +00:00                                 0       0       0       0 01:23:45.0000 2018-01-01 01:23:45.0000  


select cast('01:23:45 +02:00' as time with time zone),
       cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone),
       extract(timezone_hour from cast('01:23:45 +02:00' as time with time zone)),
       extract(timezone_minute from cast('01:23:45 +02:00' as time with time zone)),
       extract(timezone_hour from cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone)),
       extract(timezone_minute from cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone)),
       cast(cast('01:23:45 +02:00' as time with time zone) as time),
       cast(cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone) as timestamp)
  from rdb$database;

                                          CAST                                                      CAST EXTRACT EXTRACT EXTRACT EXTRACT          CAST                      CAST 
============================================== ========================================================= ======= ======= ======= ======= ============= ========================= 
01:23:45.0000 +02:00                           2018-01-01 01:23:45.0000 +02:00                                 2       0       2       0 23:23:45.0000 2017-12-31 23:23:45.0000  


select time '01:23:45 +02:00',
       timestamp '2018-01-01 01:23:45 +02:00',
       extract(timezone_hour from time '01:23:45 +02:00'),
       extract(timezone_minute from time '01:23:45 +02:00'),
       extract(timezone_hour from timestamp '2018-01-01 01:23:45 +02:00'),
       extract(timezone_minute from timestamp '2018-01-01 01:23:45 +02:00'),
       cast(time '01:23:45 +02:00' as time),
       cast(timestamp '2018-01-01 01:23:45 +02:00' as timestamp)
  from rdb$database;

                                      CONSTANT                                                  CONSTANT EXTRACT EXTRACT EXTRACT EXTRACT          CAST                      CAST 
============================================== ========================================================= ======= ======= ======= ======= ============= ========================= 
01:23:45.0000 +02:00                           2018-01-01 01:23:45.0000 +02:00                                 2       0       2       0 23:23:45.0000 2017-12-31 23:23:45.0000  



---


set time zone '-02:00';

select cast('01:23:45' as time with time zone),
       cast('2018-01-01 01:23:45' as timestamp with time zone),
       extract(timezone_hour from cast('01:23:45' as time with time zone)),
       extract(timezone_minute from cast('01:23:45' as time with time zone)),
       extract(timezone_hour from cast('2018-01-01 01:23:45' as timestamp with time zone)),
       extract(timezone_minute from cast('2018-01-01 01:23:45' as timestamp with time zone)),
       cast(cast('01:23:45' as time with time zone) as time),
       cast(cast('2018-01-01 01:23:45' as timestamp with time zone) as timestamp)
  from rdb$database;

                                          CAST                                                      CAST EXTRACT EXTRACT EXTRACT EXTRACT          CAST                      CAST 
============================================== ========================================================= ======= ======= ======= ======= ============= ========================= 
01:23:45.0000 -02:00                           2018-01-01 01:23:45.0000 -02:00                                -2       0      -2       0 01:23:45.0000 2018-01-01 01:23:45.0000  


select cast('01:23:45 +02:00' as time with time zone),
       cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone),
       extract(timezone_hour from cast('01:23:45 +02:00' as time with time zone)),
       extract(timezone_minute from cast('01:23:45 +02:00' as time with time zone)),
       extract(timezone_hour from cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone)),
       extract(timezone_minute from cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone)),
       cast(cast('01:23:45 +02:00' as time with time zone) as time),
       cast(cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone) as timestamp)
  from rdb$database;

                                          CAST                                                      CAST EXTRACT EXTRACT EXTRACT EXTRACT          CAST                      CAST 
============================================== ========================================================= ======= ======= ======= ======= ============= ========================= 
01:23:45.0000 +02:00                           2018-01-01 01:23:45.0000 +02:00                                 2       0       2       0 21:23:45.0000 2017-12-31 21:23:45.0000  



---


select extract(hour from timestamp '2018-01-02 03:04:05.6789 -03:00'),
       extract(minute from timestamp '2018-01-02 03:04:05.6789 -03:00'),
       extract(second from timestamp '2018-01-02 03:04:05.6789 -03:00'),
       extract(millisecond from timestamp '2018-01-02 03:04:05.6789 -03:00'),
       extract(year from timestamp '2018-01-02 03:04:05.6789 -03:00'),
       extract(month from timestamp '2018-01-02 03:04:05.6789 -03:00'),
       extract(day from timestamp '2018-01-02 03:04:05.6789 -03:00')
  from rdb$database;

EXTRACT EXTRACT      EXTRACT      EXTRACT EXTRACT EXTRACT EXTRACT 
======= ======= ============ ============ ======= ======= ======= 
      3       4       5.6789        678.9    2018       1       2 


select extract(hour from time '03:04:05.6789 -03:00'),
       extract(minute from time '03:04:05.6789 -03:00'),
       extract(second from time '03:04:05.6789 -03:00'),
       extract(millisecond from time '03:04:05.6789 -03:00')
  from rdb$database;

EXTRACT EXTRACT      EXTRACT      EXTRACT 
======= ======= ============ ============ 
      3       4       5.6789        678.9 



---


-- DST starts at 2017-10-15 00:00 in America/Sao_Paulo

select timestamp '2017-10-14 22:00 America/Sao_Paulo', extract(timezone_hour from timestamp '2017-10-14 22:00 America/Sao_Paulo'),
       timestamp '2017-10-14 22:00 America/Sao_Paulo' + 1, extract(timezone_hour from timestamp '2017-10-14 22:00 America/Sao_Paulo' + 1),
       timestamp '2017-10-14 22:00 America/Sao_Paulo' + 2, extract(timezone_hour from timestamp '2017-10-14 22:00 America/Sao_Paulo' + 2),
       timestamp '2017-10-14 22:00 America/Sao_Paulo' + 3, extract(timezone_hour from timestamp '2017-10-14 22:00 America/Sao_Paulo' + 3),
       timestamp '2017-10-16 22:00 America/Sao_Paulo', extract(timezone_hour from timestamp '2017-10-16 22:00 America/Sao_Paulo'),
       timestamp '2017-10-16 22:00 America/Sao_Paulo' - 1, extract(timezone_hour from timestamp '2017-10-16 22:00 America/Sao_Paulo' - 1),
       timestamp '2017-10-16 22:00 America/Sao_Paulo' - 2, extract(timezone_hour from timestamp '2017-10-16 22:00 America/Sao_Paulo' - 2),
       timestamp '2017-10-16 22:00 America/Sao_Paulo' - 3, extract(timezone_hour from timestamp '2017-10-16 22:00 America/Sao_Paulo' - 3)
  from rdb$database;

                                                 CONSTANT EXTRACT                                                       ADD EXTRACT                                                       ADD EXTRACT                                                       ADD EXTRACT                                                  CONSTANT EXTRACT                                                  SUBTRACT EXTRACT                                                  SUBTRACT EXTRACT                                                  SUBTRACT EXTRACT 
========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= 
2017-10-14 22:00:00.0000 America/Sao_Paulo                     -3 2017-10-15 23:00:00.0000 America/Sao_Paulo                     -2 2017-10-16 23:00:00.0000 America/Sao_Paulo                     -2 2017-10-17 23:00:00.0000 America/Sao_Paulo                     -2 2017-10-16 22:00:00.0000 America/Sao_Paulo                     -2 2017-10-15 22:00:00.0000 America/Sao_Paulo                     -2 2017-10-14 21:00:00.0000 America/Sao_Paulo                     -3 2017-10-13 21:00:00.0000 America/Sao_Paulo                     -3 


select dateadd(1 hour to timestamp '2017-10-14 20:00 America/Sao_Paulo'),
       dateadd(2 hour to timestamp '2017-10-14 20:00 America/Sao_Paulo'),
       dateadd(3 hour to timestamp '2017-10-14 20:00 America/Sao_Paulo'),
       dateadd(4 hour to timestamp '2017-10-14 20:00 America/Sao_Paulo'),
       dateadd(5 hour to timestamp '2017-10-14 20:00 America/Sao_Paulo')
  from rdb$database;

                                                  DATEADD                                                   DATEADD                                                   DATEADD                                                   DATEADD                                                   DATEADD 
========================================================= ========================================================= ========================================================= ========================================================= ========================================================= 
2017-10-14 21:00:00.0000 America/Sao_Paulo                2017-10-14 22:00:00.0000 America/Sao_Paulo                2017-10-14 23:00:00.0000 America/Sao_Paulo                2017-10-15 01:00:00.0000 America/Sao_Paulo                2017-10-15 02:00:00.0000 America/Sao_Paulo                



-- DST ends at 2018-02-18 00:00 in America/Sao_Paulo

select timestamp '2018-02-17 22:00 America/Sao_Paulo', extract(timezone_hour from timestamp '2018-02-17 22:00 America/Sao_Paulo'),
       timestamp '2018-02-17 22:00 America/Sao_Paulo' + 1, extract(timezone_hour from timestamp '2018-02-17 22:00 America/Sao_Paulo' + 1),
       timestamp '2018-02-17 22:00 America/Sao_Paulo' + 2, extract(timezone_hour from timestamp '2018-02-17 22:00 America/Sao_Paulo' + 2),
       timestamp '2018-02-17 22:00 America/Sao_Paulo' + 3, extract(timezone_hour from timestamp '2018-02-17 22:00 America/Sao_Paulo' + 3),
       timestamp '2018-02-19 22:00 America/Sao_Paulo', extract(timezone_hour from timestamp '2018-02-19 22:00 America/Sao_Paulo'),
       timestamp '2018-02-19 22:00 America/Sao_Paulo' - 1, extract(timezone_hour from timestamp '2018-02-19 22:00 America/Sao_Paulo' - 1),
       timestamp '2018-02-19 22:00 America/Sao_Paulo' - 2, extract(timezone_hour from timestamp '2018-02-19 22:00 America/Sao_Paulo' - 2),
       timestamp '2018-02-19 22:00 America/Sao_Paulo' - 3, extract(timezone_hour from timestamp '2018-02-19 22:00 America/Sao_Paulo' - 3)
  from rdb$database;

                                                 CONSTANT EXTRACT                                                       ADD EXTRACT                                                       ADD EXTRACT                                                       ADD EXTRACT                                                  CONSTANT EXTRACT                                                  SUBTRACT EXTRACT                                                  SUBTRACT EXTRACT                                                  SUBTRACT EXTRACT 
========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= ========================================================= ======= 
2018-02-17 22:00:00.0000 America/Sao_Paulo                     -2 2018-02-18 21:00:00.0000 America/Sao_Paulo                     -3 2018-02-19 21:00:00.0000 America/Sao_Paulo                     -3 2018-02-20 21:00:00.0000 America/Sao_Paulo                     -3 2018-02-19 22:00:00.0000 America/Sao_Paulo                     -3 2018-02-18 22:00:00.0000 America/Sao_Paulo                     -3 2018-02-17 23:00:00.0000 America/Sao_Paulo                     -2 2018-02-16 23:00:00.0000 America/Sao_Paulo                     -2 


select dateadd(1 hour to timestamp '2018-02-17 22:00 America/Sao_Paulo'),
       dateadd(2 hour to timestamp '2018-02-17 22:00 America/Sao_Paulo'),
       dateadd(3 hour to timestamp '2018-02-17 22:00 America/Sao_Paulo'),
       dateadd(4 hour to timestamp '2018-02-17 22:00 America/Sao_Paulo')
  from rdb$database;

                                                  DATEADD                                                   DATEADD                                                   DATEADD                                                   DATEADD 
========================================================= ========================================================= ========================================================= ========================================================= 
2018-02-17 23:00:00.0000 America/Sao_Paulo                2018-02-17 23:00:00.0000 America/Sao_Paulo                2018-02-18 00:00:00.0000 America/Sao_Paulo                2018-02-18 01:00:00.0000 America/Sao_Paulo                


select dateadd(-1 hour to timestamp '2018-02-18 01:00 America/Sao_Paulo'),
       dateadd(-2 hour to timestamp '2018-02-18 01:00 America/Sao_Paulo'),
       dateadd(-3 hour to timestamp '2018-02-18 01:00 America/Sao_Paulo'),
       dateadd(-4 hour to timestamp '2018-02-18 01:00 America/Sao_Paulo')
  from rdb$database;

                                                  DATEADD                                                   DATEADD                                                   DATEADD                                                   DATEADD 
========================================================= ========================================================= ========================================================= ========================================================= 
2018-02-18 00:00:00.0000 America/Sao_Paulo                2018-02-17 23:00:00.0000 America/Sao_Paulo                2018-02-17 23:00:00.0000 America/Sao_Paulo                2018-02-17 22:00:00.0000 America/Sao_Paulo                



---


select datediff(hour from timestamp '2018-04-01 10:00:00' to timestamp '2018-04-01 10:00:00 -03'),
       datediff(hour from timestamp '2018-04-01 10:00:00 -03' to timestamp '2018-04-01 10:00:00 -03'),
       datediff(hour from timestamp '2018-04-01 10:00:00' to timestamp '2018-04-01 10:00:00 -02')
  from rdb$database;

             DATEDIFF              DATEDIFF              DATEDIFF 
===================== ===================== ===================== 
                    1                     0                     0 



---


set time zone '-02:20';

select cast('01:23:45' as time with time zone),
       cast('2018-01-01 01:23:45' as timestamp with time zone),
       extract(timezone_hour from cast('01:23:45' as time with time zone)),
       extract(timezone_minute from cast('01:23:45' as time with time zone)),
       extract(timezone_hour from cast('2018-01-01 01:23:45' as timestamp with time zone)),
       extract(timezone_minute from cast('2018-01-01 01:23:45' as timestamp with time zone)),
       cast(cast('01:23:45' as time with time zone) as time),
       cast(cast('2018-01-01 01:23:45' as timestamp with time zone) as timestamp)
  from rdb$database;

                                          CAST                                                      CAST EXTRACT EXTRACT EXTRACT EXTRACT          CAST                      CAST 
============================================== ========================================================= ======= ======= ======= ======= ============= ========================= 
01:23:45.0000 -02:20                           2018-01-01 01:23:45.0000 -02:20                                -2     -20      -2     -20 01:23:45.0000 2018-01-01 01:23:45.0000  


select cast('01:23:45 +02:00' as time with time zone),
       cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone),
       extract(timezone_hour from cast('01:23:45 +02:00' as time with time zone)),
       extract(timezone_minute from cast('01:23:45 +02:00' as time with time zone)),
       extract(timezone_hour from cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone)),
       extract(timezone_minute from cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone)),
       cast(cast('01:23:45 +02:00' as time with time zone) as time),
       cast(cast('2018-01-01 01:23:45 +02:00' as timestamp with time zone) as timestamp)
  from rdb$database;

                                          CAST                                                      CAST EXTRACT EXTRACT EXTRACT EXTRACT          CAST                      CAST 
============================================== ========================================================= ======= ======= ======= ======= ============= ========================= 
01:23:45.0000 +02:00                           2018-01-01 01:23:45.0000 +02:00                                 2       0       2       0 21:03:45.0000 2017-12-31 21:03:45.0000  


select extract(timezone_hour from time '03:04:05.6789 -03:00'),
       extract(timezone_minute from time '03:04:05.6789 -03:00'),
       extract(timezone_hour from timestamp '2018-01-01 03:04:05.6789 -03:00'),
       extract(timezone_minute from timestamp '2018-01-01 03:04:05.6789 -03:00')
  from rdb$database;

EXTRACT EXTRACT EXTRACT EXTRACT 
======= ======= ======= ======= 
     -3       0      -3       0 



---


select extract(timezone_hour from cast('now' as timestamp with time zone)) = -2,
       extract(timezone_minute from cast('now' as timestamp with time zone)) = -20
  from rdb$database;

                
======= ======= 
<true>  <true>  



---


set time zone '-02:00';

select cast('01:23:45 -01' as time),
       cast('01:23:45 +01' as time),
       cast('2018-01-01 01:23:45 -01' as timestamp),
       cast('2018-01-01 01:23:45 +01' as timestamp)
  from rdb$database;

         CAST          CAST                      CAST                      CAST 
============= ============= ========================= ========================= 
00:23:45.0000 22:23:45.0000 2018-01-01 00:23:45.0000  2017-12-31 22:23:45.0000  


select cast(cast('01:23:45' as time with time zone) as timestamp with time zone) = cast(current_date || ' 01:23:45' as timestamp with time zone)
  from rdb$database;

        
======= 
<true>  


select cast(cast('2018-01-01 01:23:45' as timestamp with time zone) as time with time zone)
  from rdb$database;

                                          CAST 
============================================== 
01:23:45.0000 -02:00                           


select cast(cast('2018-01-01 01:23:45 -04' as timestamp with time zone) as time with time zone)
  from rdb$database;

                                          CAST 
============================================== 
01:23:45.0000 -04:00                           


select cast(cast('2018-01-01 01:23:45' as timestamp with time zone) as date)
  from rdb$database;

       CAST 
=========== 
2018-01-01  


select cast(cast('2018-01-01 01:23:45 -04' as timestamp with time zone) as date)
  from rdb$database;

       CAST 
=========== 
2018-01-01  


select cast(cast('2018-01-01 01:23:45' as timestamp with time zone) as time)
  from rdb$database;

         CAST 
============= 
01:23:45.0000 


select cast(cast('2018-01-01 01:23:45 -04' as timestamp with time zone) as time)
  from rdb$database;

         CAST 
============= 
03:23:45.0000 


select cast(cast('2018-01-01 01:23:45' as timestamp with time zone) as timestamp)
  from rdb$database;

                     CAST 
========================= 
2018-01-01 01:23:45.0000  


select cast(cast('2018-01-01 01:23:45 -04' as timestamp with time zone) as timestamp)
  from rdb$database;

                     CAST 
========================= 
2018-01-01 03:23:45.0000  


select cast(timestamp '2018-01-01 01:23:45' as timestamp with time zone)
  from rdb$database;

                                                     CAST 
========================================================= 
2018-01-01 01:23:45.0000 -02:00                           


select cast(timestamp '2018-01-01 01:23:45' as time with time zone)
  from rdb$database;

                                          CAST 
============================================== 
01:23:45.0000 -02:00                           


select cast(cast('01:23:45' as time) as timestamp with time zone) = cast(cast('01:23:45' as time with time zone) as timestamp with time zone)
  from rdb$database;

        
======= 
<true>  


select cast(cast('01:23:45' as time) as time with time zone) = '01:23:45 -02:00'
  from rdb$database;

        
======= 
<true>  


select cast(cast(cast('01:23:45 -03' as time with time zone) as timestamp) as time) = '02:23:45'
  from rdb$database;

        
======= 
<true>  


select cast(cast('01:23:45 -03' as time with time zone) as time) = '02:23:45'
  from rdb$database;

        
======= 
<true>  


-- Error
select cast(cast('01:23:45 -03' as time with time zone) as date)
  from rdb$database;

       CAST 
=========== 
Statement failed, SQLSTATE = 22018
conversion error from string "01:23:45.0000 -03:00"
After line 236 in file fb_sql_time_zone_a.sql

select cast(date '2018-01-01' as timestamp with time zone)
  from rdb$database;

                                                     CAST 
========================================================= 
2018-01-01 00:00:00.0000 -02:00                           


-- Error
select cast(date '2018-01-01' as time with time zone)
  from rdb$database;

                                          CAST 
============================================== 
Statement failed, SQLSTATE = 22018
conversion error from string "2018-01-01"
After line 243 in file fb_sql_time_zone_a.sql


---


select timestamp '2018-02-03 America/Sao_Paulo'
  from rdb$database;

                                                 CONSTANT 
========================================================= 
2018-02-03 00:00:00.0000 America/Sao_Paulo                



---


select cast('23:23:34 +05' as time with time zone) + 1,
       cast('23:23:34 +05' as time with time zone) - 1
  from rdb$database;

                                           ADD                                       SUBTRACT 
============================================== ============================================== 
23:23:35.0000 +05:00                           23:23:33.0000 +05:00                           


select cast('2018-01-01 23:23:34 +05' as timestamp with time zone) + 1,
       cast('2018-01-01 23:23:34 +05' as timestamp with time zone) - 1
  from rdb$database;

                                                      ADD                                                  SUBTRACT 
========================================================= ========================================================= 
2018-01-02 23:23:34.0000 +05:00                           2017-12-31 23:23:34.0000 +05:00                           


select date '2018-01-01' + cast('23:23:34 +05' as time with time zone),
       cast('23:23:34 +05' as time with time zone) + date '2018-01-01',
       date '2018-01-01' + cast('23:23:34 +05' as time),
       cast('23:23:34 +05' as time) + date '2018-01-01'
  from rdb$database;

                                                      ADD                                                       ADD                       ADD                       ADD 
========================================================= ========================================================= ========================= ========================= 
2018-01-01 23:23:34.0000 +05:00                           2018-01-01 23:23:34.0000 +05:00                           2018-01-01 16:23:34.0000  2018-01-01 16:23:34.0000  


select cast('12:00:00 +01:00' as time with time zone) - cast('12:00:00 +00:00' as time with time zone),
       cast('23:00:00 -01:00' as time with time zone) - cast('23:00:00 +00:00' as time with time zone),
       time '12:00:00' - cast('12:00:00 +00:00' as time with time zone),
       cast('12:00:00 +00:00' as time with time zone) - time '12:00:00'
  from rdb$database;

    SUBTRACT     SUBTRACT     SUBTRACT     SUBTRACT 
============ ============ ============ ============ 
  -3600.0000  -82800.0000    7200.0000   -7200.0000 


select cast('2018-01-01 12:00:00 +01:00' as timestamp with time zone) - cast('2018-01-01 12:00:00 +00:00' as timestamp with time zone),
       cast('2018-01-01 23:00:00 -01:00' as timestamp with time zone) - cast('2018-01-01 23:00:00 +00:00' as timestamp with time zone),
       timestamp '2018-01-01 12:00:00' - cast('2018-01-01 12:00:00 +00:00' as timestamp with time zone),
       cast('2018-01-01 12:00:00 +00:00' as timestamp with time zone) - timestamp '2018-01-01 12:00:00'
  from rdb$database;

             SUBTRACT              SUBTRACT              SUBTRACT              SUBTRACT 
===================== ===================== ===================== ===================== 
         -0.041666667           0.041666667           0.083333333          -0.083333333 



---


select cast('10:00:00 +05' as time with time zone) = cast('10:00:00 05' as time with time zone),
       cast('10:00:00 05' as time with time zone) = cast('11:00:00 +06' as time with time zone),
       cast('10:00:00 +12' as time with time zone) = cast('10:00:00 -12' as time with time zone),
       cast('10:00:00 -02' as time with time zone) = cast('10:00:00' as time with time zone),
       cast('10:00:00 -02' as time with time zone) = cast('10:00:00' as time),
       cast('10:00:00' as time) = cast('10:00:00 -02' as time with time zone),
       cast('10:00:00 +05' as time with time zone) = cast('10:00:00 +06' as time with time zone),
       cast('10:00:00 +05' as time with time zone) < cast('10:00:00 +06' as time with time zone),
       cast('10:00:00 +05' as time with time zone) > cast('10:00:00 +06' as time with time zone),
       localtime = current_time at time zone '-02:00'
  from rdb$database;

                                                                                
======= ======= ======= ======= ======= ======= ======= ======= ======= ======= 
<true>  <true>  <true>  <true>  <true>  <true>  <false> <false> <true>  <true>  


select cast('2018-01-01 10:00:00 +05' as timestamp with time zone) = cast('2018-01-01 10:00:00 05' as timestamp with time zone),
       cast('2018-01-01 10:00:00 05' as timestamp with time zone) = cast('2018-01-01 11:00:00 +06' as timestamp with time zone),
       cast('2018-01-01 10:00:00 +12' as timestamp with time zone) = cast('2018-01-01 10:00:00 -12' as timestamp with time zone),
       cast('2018-01-01 10:00:00 -02' as timestamp with time zone) = cast('2018-01-01 10:00:00' as timestamp with time zone),
       cast('2018-01-01 10:00:00 -02' as timestamp with time zone) = cast('2018-01-01 10:00:00' as timestamp),
       cast('2018-01-01 10:00:00' as timestamp) = cast('2018-01-01 10:00:00 -02' as timestamp with time zone),
       cast('2018-01-01 10:00:00 +05' as timestamp with time zone) = cast('2018-01-01 10:00:00 +06' as timestamp with time zone),
       cast('2018-01-01 10:00:00 +05' as timestamp with time zone) < cast('2018-01-01 10:00:00 +06' as timestamp with time zone),
       cast('2018-01-01 10:00:00 +05' as timestamp with time zone) > cast('2018-01-01 10:00:00 +06' as timestamp with time zone),
       localtimestamp = current_timestamp at time zone '-02:00'
  from rdb$database;

                                                                                
======= ======= ======= ======= ======= ======= ======= ======= ======= ======= 
<true>  <true>  <false> <true>  <true>  <true>  <false> <false> <true>  <true>  



---


set time zone '-03:00';


select cast(time '10:11:12.1345' as time),
       cast(time '10:11:12.1345' as time with time zone),
       substring(cast(time '10:11:12.1345' as timestamp) from 12),
       substring(cast(time '10:11:12.1345' as timestamp with time zone) from 12) from rdb$database;

         CAST                                           CAST SUBSTRING                 SUBSTRING                                                 
============= ============================================== ========================= ========================================================= 
10:11:12.1345 10:11:12.1345 -03:00                           10:11:12.1345             10:11:12.1345 -03:00                                      


select cast(timestamp '2020-05-20 10:11:12.1345' as time),
       cast(timestamp '2020-05-20 10:11:12.1345' as time with time zone),
       cast(timestamp '2020-05-20 10:11:12.1345' as timestamp),
       cast(timestamp '2020-05-20 10:11:12.1345' as timestamp with time zone) from rdb$database;

         CAST                                           CAST                      CAST                                                      CAST 
============= ============================================== ========================= ========================================================= 
10:11:12.1345 10:11:12.1345 -03:00                           2020-05-20 10:11:12.1345  2020-05-20 10:11:12.1345 -03:00                           


select cast(time '10:11:12.1345 america/sao_paulo' as time),
       cast(time '10:11:12.1345 america/sao_paulo' as time with time zone),
       substring(cast(time '10:11:12.1345 america/sao_paulo' as timestamp) from 12),
       substring(cast(time '10:11:12.1345 america/sao_paulo' as timestamp with time zone) from 12) from rdb$database;

         CAST                                           CAST SUBSTRING                 SUBSTRING                                                 
============= ============================================== ========================= ========================================================= 
10:11:12.1345 10:11:12.1345 America/Sao_Paulo                10:11:12.1345             10:11:12.1345 America/Sao_Paulo                           


select cast(timestamp '2020-05-20 10:11:12.1345 america/sao_paulo' as time),
       cast(timestamp '2020-05-20 10:11:12.1345 america/sao_paulo' as time with time zone),
       cast(timestamp '2020-05-20 10:11:12.1345 america/sao_paulo' as timestamp),
       cast(timestamp '2020-05-20 10:11:12.1345 america/sao_paulo' as timestamp with time zone) from rdb$database;

         CAST                                           CAST                      CAST                                                      CAST 
============= ============================================== ========================= ========================================================= 
10:11:12.1345 10:11:12.1345 America/Sao_Paulo                2020-05-20 10:11:12.1345  2020-05-20 10:11:12.1345 America/Sao_Paulo                



---


set time zone '-02:00';


select time '20:01:02 -05:00' at time zone '-05:00',
       time '20:01:02 -05:00' at time zone '-02:00',
       time '20:01:02 -05:00' at time zone '+03:00',
       time '20:01:02' at time zone '-05:00',
       time '20:01:02' at time zone '-02:00',
       time '20:01:02' at time zone '+03:00',
       time '20:01:02 -05:00' at local,
       time '20:01:02' at local
  from rdb$database;

                                            AT                                             AT                                             AT                                             AT                                             AT                                             AT                                             AT                                             AT 
============================================== ============================================== ============================================== ============================================== ============================================== ============================================== ============================================== ============================================== 
20:01:02.0000 -05:00                           23:01:02.0000 -02:00                           04:01:02.0000 +03:00                           17:01:02.0000 -05:00                           20:01:02.0000 -02:00                           01:01:02.0000 +03:00                           23:01:02.0000 -02:00                           20:01:02.0000 -02:00                           


select timestamp '2018-01-01 20:01:02 -05:00' at time zone '-05:00',
       timestamp '2018-01-01 20:01:02 -05:00' at time zone '-02:00',
       timestamp '2018-01-01 20:01:02 -05:00' at time zone '+03:00',
       timestamp '2018-01-01 20:01:02' at time zone '-05:00',
       timestamp '2018-01-01 20:01:02' at time zone '-02:00',
       timestamp '2018-01-01 20:01:02' at time zone '+03:00',
       timestamp '2018-01-01 20:01:02 -05:00' at local,
       timestamp '2018-01-01 20:01:02' at local
  from rdb$database;

                                                       AT                                                        AT                                                        AT                                                        AT                                                        AT                                                        AT                                                        AT                                                        AT 
========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= 
2018-01-01 20:01:02.0000 -05:00                           2018-01-01 23:01:02.0000 -02:00                           2018-01-02 04:01:02.0000 +03:00                           2018-01-01 17:01:02.0000 -05:00                           2018-01-01 20:01:02.0000 -02:00                           2018-01-02 01:01:02.0000 +03:00                           2018-01-01 23:01:02.0000 -02:00                           2018-01-01 20:01:02.0000 -02:00                           



---


select timestamp '2018-05-01 20:01:02 America/Sao_Paulo' at time zone 'America/Los_Angeles',
       timestamp '2018-04-01 20:01:02 America/Sao_Paulo' at time zone 'America/Los_Angeles',
       timestamp '2018-03-01 20:01:02 America/Sao_Paulo' at time zone 'America/Los_Angeles',
       timestamp '2018-02-01 20:01:02 America/Sao_Paulo' at time zone 'America/Los_Angeles',
       timestamp '2018-01-01 20:01:02 America/Sao_Paulo' at time zone 'America/Los_Angeles',
       timestamp '2018-01-01 20:01:02 America/Sao_Paulo' at time zone 'America/Los_Angeles' + 1,
       1 + timestamp '2018-01-01 20:01:02 America/Sao_Paulo' at time zone 'America/Los_Angeles',
       1 + timestamp '2018-01-01 20:01:02 America/Sao_Paulo' at time zone 'America/Los_Angeles' + 1
  from rdb$database;

                                                       AT                                                        AT                                                        AT                                                        AT                                                        AT                                                       ADD                                                       ADD                                                       ADD 
========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= 
2018-05-01 16:01:02.0000 America/Los_Angeles              2018-04-01 16:01:02.0000 America/Los_Angeles              2018-03-01 15:01:02.0000 America/Los_Angeles              2018-02-01 14:01:02.0000 America/Los_Angeles              2018-01-01 14:01:02.0000 America/Los_Angeles              2018-01-02 14:01:02.0000 America/Los_Angeles              2018-01-02 14:01:02.0000 America/Los_Angeles              2018-01-03 14:01:02.0000 America/Los_Angeles              



---


select first_day(of year from timestamp '2018-03-08 10:11:12 America/Sao_Paulo'),
       first_day(of month from timestamp '2018-03-08 10:11:12 America/Sao_Paulo'),
       first_day(of week from timestamp '2018-03-08 10:11:12 America/Sao_Paulo'),
       last_day(of year from timestamp '2018-03-08 10:11:12 America/Sao_Paulo'),
       last_day(of month from timestamp '2018-03-08 10:11:12 America/Sao_Paulo'),
       last_day(of week from timestamp '2018-03-08 10:11:12 America/Sao_Paulo')
  from rdb$database;

                                                FIRST_DAY                                                 FIRST_DAY                                                 FIRST_DAY                                                  LAST_DAY                                                  LAST_DAY                                                  LAST_DAY 
========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= 
2018-01-01 10:11:12.0000 America/Sao_Paulo                2018-03-01 10:11:12.0000 America/Sao_Paulo                2018-03-04 10:11:12.0000 America/Sao_Paulo                2018-12-31 10:11:12.0000 America/Sao_Paulo                2018-03-31 10:11:12.0000 America/Sao_Paulo                2018-03-10 10:11:12.0000 America/Sao_Paulo                



---


select timestamp '2017-03-12 02:30 America/New_York' t1,
       timestamp '2017-03-12 02:30 America/New_York' at time zone '-05' t2,
       dateadd(-1 minute to timestamp '2017-03-12 02:30 America/New_York') t3,
       dateadd(1 minute to timestamp '2017-03-12 02:30 America/New_York') t4,
       dateadd(-1 hour to timestamp '2017-03-12 02:30 America/New_York') t5,
       dateadd(1 hour to timestamp '2017-03-12 02:30 America/New_York') t6
  from rdb$database;

                                                       T1                                                        T2                                                        T3                                                        T4                                                        T5                                                        T6 
========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= 
2017-03-12 03:30:00.0000 America/New_York                 2017-03-12 02:30:00.0000 -05:00                           2017-03-12 03:29:00.0000 America/New_York                 2017-03-12 03:31:00.0000 America/New_York                 2017-03-12 01:30:00.0000 America/New_York                 2017-03-12 04:30:00.0000 America/New_York                 


select timestamp '2017-11-05 01:30 America/New_York' t1,
       timestamp '2017-11-05 01:30 America/New_York' at time zone '-04' t2,
       dateadd(-1 minute to timestamp '2017-11-05 01:30 America/New_York') t3,
       dateadd(1 minute to timestamp '2017-11-05 01:30 America/New_York') t4,
       dateadd(-1 hour to timestamp '2017-11-05 01:30 America/New_York') t5,
       dateadd(1 hour to timestamp '2017-11-05 01:30 America/New_York') t6
  from rdb$database;

                                                       T1                                                        T2                                                        T3                                                        T4                                                        T5                                                        T6 
========================================================= ========================================================= ========================================================= ========================================================= ========================================================= ========================================================= 
2017-11-05 01:30:00.0000 America/New_York                 2017-11-05 01:30:00.0000 -04:00                           2017-11-05 01:29:00.0000 America/New_York                 2017-11-05 01:31:00.0000 America/New_York                 2017-11-05 00:30:00.0000 America/New_York                 2017-11-05 01:30:00.0000 America/New_York                 



---


set bind of timestamp with time zone to legacy;
set bind of time with time zone to legacy;
set sqlda_display on;

select timestamp '2018-05-01 20:01:02 America/Sao_Paulo',
       dateadd(extract(timezone_hour from time '20:01:02 America/Sao_Paulo') + 3 hour to time '20:01:02 America/Sao_Paulo')
  from rdb$database;

INPUT message field count: 0

OUTPUT message field count: 2
01: sqltype: 510 TIMESTAMP scale: 0 subtype: 0 len: 8
  :  name: CONSTANT  alias: CONSTANT
  : table:   owner: 
02: sqltype: 560 TIME scale: 0 subtype: 0 len: 4
  :  name: DATEADD  alias: DATEADD
  : table:   owner: 

                 CONSTANT       DATEADD 
========================= ============= 
2018-05-01 21:01:02.0000  21:01:02.0000 


select 1
  from rdb$database
  where current_timestamp = ? and
        current_time = ?;

INPUT message field count: 2
01: sqltype: 510 TIMESTAMP scale: 0 subtype: 0 len: 8
  :  name:   alias: 
  : table:   owner: 
02: sqltype: 560 TIME scale: 0 subtype: 0 len: 4
  :  name:   alias: 
  : table:   owner: 

OUTPUT message field count: 1
01: sqltype: 496 LONG scale: 0 subtype: 0 len: 4
  :  name: CONSTANT  alias: CONSTANT
  : table:   owner: 

    CONSTANT 
============ 
Statement failed, SQLSTATE = 07002
Dynamic SQL Error
-SQLDA error
-Wrong number of parameters (expected 2, got 0)
After line 424 in file fb_sql_time_zone_a.sql

set sqlda_display off;
set bind of timestamp with time zone to native;
set bind of time with time zone to native;



---


create table timetz (n integer, v time with time zone);
create unique index timetz_uk on timetz (v);

insert into timetz values (0, '11:33:33 America/Sao_Paulo');
insert into timetz values (1, '11:33:33.456');
insert into timetz values (2, '11:33:33.456 -1');
insert into timetz values (3, '11:33:33.456 +1');
insert into timetz values (4, '11:33:33');
insert into timetz values (5, '11:33:33 -1');
insert into timetz values (6, '11:33:33 +1');

-- Duplicate in UTC.
insert into timetz values (7, '12:33:33 +0');
Statement failed, SQLSTATE = 23000
attempt to store duplicate value (visible to active transactions) in unique index "TIMETZ_UK"
-Problematic key value is ("V" = '12:33:33.0000 +00:00')
After line 449 in file fb_sql_time_zone_a.sql
insert into timetz values (8, '13:33:33 +1');
Statement failed, SQLSTATE = 23000
attempt to store duplicate value (visible to active transactions) in unique index "TIMETZ_UK"
-Problematic key value is ("V" = '13:33:33.0000 +01:00')
After line 452 in file fb_sql_time_zone_a.sql
insert into timetz values (9, '14:33:33 +2');
Statement failed, SQLSTATE = 23000
attempt to store duplicate value (visible to active transactions) in unique index "TIMETZ_UK"
-Problematic key value is ("V" = '14:33:33.0000 +02:00')
After line 453 in file fb_sql_time_zone_a.sql
insert into timetz values (10, '11:33:33 -03');
Statement failed, SQLSTATE = 23000
attempt to store duplicate value (visible to active transactions) in unique index "TIMETZ_UK"
-Problematic key value is ("V" = '11:33:33.0000 -03:00')
After line 454 in file fb_sql_time_zone_a.sql

select n, v, cast(v as time) from timetz order by v, n;

           N                                              V          CAST 
============ ============================================== ============= 
           6 11:33:33.0000 +01:00                           08:33:33.0000 
           3 11:33:33.4560 +01:00                           08:33:33.4560 
           5 11:33:33.0000 -01:00                           10:33:33.0000 
           2 11:33:33.4560 -01:00                           10:33:33.4560 
           4 11:33:33.0000 -02:00                           11:33:33.0000 
           1 11:33:33.4560 -02:00                           11:33:33.4560 
           0 11:33:33.0000 America/Sao_Paulo                12:33:33.0000 


select n, v from timetz order by v + 0, n;

           N                                              V 
============ ============================================== 
           6 11:33:33.0000 +01:00                           
           3 11:33:33.4560 +01:00                           
           5 11:33:33.0000 -01:00                           
           2 11:33:33.4560 -01:00                           
           4 11:33:33.0000 -02:00                           
           1 11:33:33.4560 -02:00                           
           0 11:33:33.0000 America/Sao_Paulo                


commit;
drop index timetz_uk;
create index timetz_idx on timetz (v);

-- Duplicate in UTC.
insert into timetz values (7, '12:33:33 +0');
insert into timetz values (8, '13:33:33 +1');
insert into timetz values (9, '14:33:33 +2');

select n, v, cast(v as time) from timetz order by cast(v as time), n;

           N                                              V          CAST 
============ ============================================== ============= 
           6 11:33:33.0000 +01:00                           08:33:33.0000 
           3 11:33:33.4560 +01:00                           08:33:33.4560 
           5 11:33:33.0000 -01:00                           10:33:33.0000 
           7 12:33:33.0000 +00:00                           10:33:33.0000 
           8 13:33:33.0000 +01:00                           10:33:33.0000 
           9 14:33:33.0000 +02:00                           10:33:33.0000 
           2 11:33:33.4560 -01:00                           10:33:33.4560 
           4 11:33:33.0000 -02:00                           11:33:33.0000 
           1 11:33:33.4560 -02:00                           11:33:33.4560 
           0 11:33:33.0000 America/Sao_Paulo                12:33:33.0000 

select n, v, cast(v as time) from timetz order by v, n;

           N                                              V          CAST 
============ ============================================== ============= 
           6 11:33:33.0000 +01:00                           08:33:33.0000 
           3 11:33:33.4560 +01:00                           08:33:33.4560 
           5 11:33:33.0000 -01:00                           10:33:33.0000 
           7 12:33:33.0000 +00:00                           10:33:33.0000 
           8 13:33:33.0000 +01:00                           10:33:33.0000 
           9 14:33:33.0000 +02:00                           10:33:33.0000 
           2 11:33:33.4560 -01:00                           10:33:33.4560 
           4 11:33:33.0000 -02:00                           11:33:33.0000 
           1 11:33:33.4560 -02:00                           11:33:33.4560 
           0 11:33:33.0000 America/Sao_Paulo                12:33:33.0000 


select n, v from timetz order by v + 0, n;

           N                                              V 
============ ============================================== 
           6 11:33:33.0000 +01:00                           
           3 11:33:33.4560 +01:00                           
           5 11:33:33.0000 -01:00                           
           7 12:33:33.0000 +00:00                           
           8 13:33:33.0000 +01:00                           
           9 14:33:33.0000 +02:00                           
           2 11:33:33.4560 -01:00                           
           4 11:33:33.0000 -02:00                           
           1 11:33:33.4560 -02:00                           
           0 11:33:33.0000 America/Sao_Paulo                


commit;
drop index timetz_idx;

select n, v, cast(v as time) from timetz order by v, n;

           N                                              V          CAST 
============ ============================================== ============= 
           6 11:33:33.0000 +01:00                           08:33:33.0000 
           3 11:33:33.4560 +01:00                           08:33:33.4560 
           5 11:33:33.0000 -01:00                           10:33:33.0000 
           7 12:33:33.0000 +00:00                           10:33:33.0000 
           8 13:33:33.0000 +01:00                           10:33:33.0000 
           9 14:33:33.0000 +02:00                           10:33:33.0000 
           2 11:33:33.4560 -01:00                           10:33:33.4560 
           4 11:33:33.0000 -02:00                           11:33:33.0000 
           1 11:33:33.4560 -02:00                           11:33:33.4560 
           0 11:33:33.0000 America/Sao_Paulo                12:33:33.0000 


delete from timetz;
insert into timetz values (1, '11:33:33.456');


---


create table timestamptz (n integer, v timestamp with time zone);
create unique index timestamptz_uk on timestamptz (v);

insert into timestamptz values (1, '2018-01-01 11:33:33.456');
insert into timestamptz values (2, '2018-01-01 11:33:33.456 -1');
insert into timestamptz values (3, '2018-01-01 11:33:33.456 +1');
insert into timestamptz values (4, '2018-01-01 11:33:33');
insert into timestamptz values (5, '2018-01-01 11:33:33 -1');
insert into timestamptz values (6, '2018-01-01 11:33:33 +1');

-- Duplicate in UTC.
insert into timestamptz values (7, '2018-01-01 12:33:33 +0');
Statement failed, SQLSTATE = 23000
attempt to store duplicate value (visible to active transactions) in unique index "TIMESTAMPTZ_UK"
-Problematic key value is ("V" = '2018-01-01 12:33:33.0000 +00:00')
After line 495 in file fb_sql_time_zone_a.sql
insert into timestamptz values (8, '2018-01-01 13:33:33 +1');
Statement failed, SQLSTATE = 23000
attempt to store duplicate value (visible to active transactions) in unique index "TIMESTAMPTZ_UK"
-Problematic key value is ("V" = '2018-01-01 13:33:33.0000 +01:00')
After line 498 in file fb_sql_time_zone_a.sql
insert into timestamptz values (9, '2018-01-01 14:33:33 +2');
Statement failed, SQLSTATE = 23000
attempt to store duplicate value (visible to active transactions) in unique index "TIMESTAMPTZ_UK"
-Problematic key value is ("V" = '2018-01-01 14:33:33.0000 +02:00')
After line 499 in file fb_sql_time_zone_a.sql

select n, v, cast(v as timestamp) from timestamptz order by v, n;

           N                                                         V                      CAST 
============ ========================================================= ========================= 
           6 2018-01-01 11:33:33.0000 +01:00                           2018-01-01 08:33:33.0000  
           3 2018-01-01 11:33:33.4560 +01:00                           2018-01-01 08:33:33.4560  
           5 2018-01-01 11:33:33.0000 -01:00                           2018-01-01 10:33:33.0000  
           2 2018-01-01 11:33:33.4560 -01:00                           2018-01-01 10:33:33.4560  
           4 2018-01-01 11:33:33.0000 -02:00                           2018-01-01 11:33:33.0000  
           1 2018-01-01 11:33:33.4560 -02:00                           2018-01-01 11:33:33.4560  


select n, v from timestamptz order by v + 0, n;

           N                                                         V 
============ ========================================================= 
           6 2018-01-01 11:33:33.0000 +01:00                           
           3 2018-01-01 11:33:33.4560 +01:00                           
           5 2018-01-01 11:33:33.0000 -01:00                           
           2 2018-01-01 11:33:33.4560 -01:00                           
           4 2018-01-01 11:33:33.0000 -02:00                           
           1 2018-01-01 11:33:33.4560 -02:00                           


commit;
drop index timestamptz_uk;
create index timestamptz_idx on timestamptz (v);

-- Duplicate in UTC.
insert into timestamptz values (7, '2018-01-01 12:33:33 +0');
insert into timestamptz values (8, '2018-01-01 13:33:33 +1');
insert into timestamptz values (9, '2018-01-01 14:33:33 +2');

select n, v, cast(v as timestamp) from timestamptz order by cast(v as timestamp), n;

           N                                                         V                      CAST 
============ ========================================================= ========================= 
           6 2018-01-01 11:33:33.0000 +01:00                           2018-01-01 08:33:33.0000  
           3 2018-01-01 11:33:33.4560 +01:00                           2018-01-01 08:33:33.4560  
           5 2018-01-01 11:33:33.0000 -01:00                           2018-01-01 10:33:33.0000  
           7 2018-01-01 12:33:33.0000 +00:00                           2018-01-01 10:33:33.0000  
           8 2018-01-01 13:33:33.0000 +01:00                           2018-01-01 10:33:33.0000  
           9 2018-01-01 14:33:33.0000 +02:00                           2018-01-01 10:33:33.0000  
           2 2018-01-01 11:33:33.4560 -01:00                           2018-01-01 10:33:33.4560  
           4 2018-01-01 11:33:33.0000 -02:00                           2018-01-01 11:33:33.0000  
           1 2018-01-01 11:33:33.4560 -02:00                           2018-01-01 11:33:33.4560  

select n, v, cast(v as timestamp) from timestamptz order by v, n;

           N                                                         V                      CAST 
============ ========================================================= ========================= 
           6 2018-01-01 11:33:33.0000 +01:00                           2018-01-01 08:33:33.0000  
           3 2018-01-01 11:33:33.4560 +01:00                           2018-01-01 08:33:33.4560  
           5 2018-01-01 11:33:33.0000 -01:00                           2018-01-01 10:33:33.0000  
           7 2018-01-01 12:33:33.0000 +00:00                           2018-01-01 10:33:33.0000  
           8 2018-01-01 13:33:33.0000 +01:00                           2018-01-01 10:33:33.0000  
           9 2018-01-01 14:33:33.0000 +02:00                           2018-01-01 10:33:33.0000  
           2 2018-01-01 11:33:33.4560 -01:00                           2018-01-01 10:33:33.4560  
           4 2018-01-01 11:33:33.0000 -02:00                           2018-01-01 11:33:33.0000  
           1 2018-01-01 11:33:33.4560 -02:00                           2018-01-01 11:33:33.4560  


select n, v from timestamptz order by v + 0, n;

           N                                                         V 
============ ========================================================= 
           6 2018-01-01 11:33:33.0000 +01:00                           
           3 2018-01-01 11:33:33.4560 +01:00                           
           5 2018-01-01 11:33:33.0000 -01:00                           
           7 2018-01-01 12:33:33.0000 +00:00                           
           8 2018-01-01 13:33:33.0000 +01:00                           
           9 2018-01-01 14:33:33.0000 +02:00                           
           2 2018-01-01 11:33:33.4560 -01:00                           
           4 2018-01-01 11:33:33.0000 -02:00                           
           1 2018-01-01 11:33:33.4560 -02:00                           


commit;
drop index timestamptz_idx;

select n, v, cast(v as timestamp) from timestamptz order by v, n;

           N                                                         V                      CAST 
============ ========================================================= ========================= 
           6 2018-01-01 11:33:33.0000 +01:00                           2018-01-01 08:33:33.0000  
           3 2018-01-01 11:33:33.4560 +01:00                           2018-01-01 08:33:33.4560  
           5 2018-01-01 11:33:33.0000 -01:00                           2018-01-01 10:33:33.0000  
           7 2018-01-01 12:33:33.0000 +00:00                           2018-01-01 10:33:33.0000  
           8 2018-01-01 13:33:33.0000 +01:00                           2018-01-01 10:33:33.0000  
           9 2018-01-01 14:33:33.0000 +02:00                           2018-01-01 10:33:33.0000  
           2 2018-01-01 11:33:33.4560 -01:00                           2018-01-01 10:33:33.4560  
           4 2018-01-01 11:33:33.0000 -02:00                           2018-01-01 11:33:33.0000  
           1 2018-01-01 11:33:33.4560 -02:00                           2018-01-01 11:33:33.4560  


delete from timestamptz;
insert into timestamptz values (1, '2018-01-01 11:33:33.456');


---


select t.*,
       extract(timezone_hour from rdb$start_timestamp at time zone 'America/Los_Angeles') start_tzh,
       extract(timezone_minute from rdb$start_timestamp at time zone 'America/Los_Angeles') start_tzm,
       extract(timezone_hour from rdb$end_timestamp at time zone 'America/Los_Angeles') end_tzh,
       extract(timezone_minute from rdb$end_timestamp at time zone 'America/Los_Angeles') end_tzm
  from rdb$time_zone_util.transitions(
    'America/Los_Angeles',
    timestamp '2015-01-01 GMT',
    timestamp '2019-01-01 GMT') t;

                                      RDB$START_TIMESTAMP                                         RDB$END_TIMESTAMP RDB$ZONE_OFFSET RDB$DST_OFFSET RDB$EFFECTIVE_OFFSET START_TZH START_TZM END_TZH END_TZM 
========================================================= ========================================================= =============== ============== ==================== ========= ========= ======= ======= 
2014-11-02 09:00:00.0000 GMT                              2015-03-08 09:59:59.9999 GMT                                         -480              0                 -480        -8         0      -8       0 
2015-03-08 10:00:00.0000 GMT                              2015-11-01 08:59:59.9999 GMT                                         -480             60                 -420        -7         0      -7       0 
2015-11-01 09:00:00.0000 GMT                              2016-03-13 09:59:59.9999 GMT                                         -480              0                 -480        -8         0      -8       0 
2016-03-13 10:00:00.0000 GMT                              2016-11-06 08:59:59.9999 GMT                                         -480             60                 -420        -7         0      -7       0 
2016-11-06 09:00:00.0000 GMT                              2017-03-12 09:59:59.9999 GMT                                         -480              0                 -480        -8         0      -8       0 
2017-03-12 10:00:00.0000 GMT                              2017-11-05 08:59:59.9999 GMT                                         -480             60                 -420        -7         0      -7       0 
2017-11-05 09:00:00.0000 GMT                              2018-03-11 09:59:59.9999 GMT                                         -480              0                 -480        -8         0      -8       0 
2018-03-11 10:00:00.0000 GMT                              2018-11-04 08:59:59.9999 GMT                                         -480             60                 -420        -7         0      -7       0 
2018-11-04 09:00:00.0000 GMT                              2019-03-10 09:59:59.9999 GMT                                         -480              0                 -480        -8         0      -8       0 



---

exit;

           N                                              V 
============ ============================================== 
           1 11:33:33.4560 -02:00                           


           N                                                         V 
============ ========================================================= 
           1 2018-01-01 11:33:33.4560 -02:00                           


SUBSTRING                                                 
========================================================= 
America/Sao_Paulo                                         


T1                             T2                             
============================== ============================== 
America/New_York               America/Los_Angeles            


SUBSTRING                                                 
========================================================= 
America/Los_Angeles                                       


           N T1                             T2                             T3                             
============ ============================== ============================== ============================== 
           0 America/Sao_Paulo              America/Los_Angeles            America/Sao_Paulo              
           1 America/Sao_Paulo              America/Los_Angeles            America/Sao_Paulo              
           2 America/Sao_Paulo              America/Los_Angeles            America/Sao_Paulo              
           3 America/Sao_Paulo              America/Los_Angeles            America/Los_Angeles            
           4 America/Los_Angeles            America/Los_Angeles            America/Los_Angeles            


           N TZ1                            TZ2                            TZ3                            
============ ============================== ============================== ============================== 
           1 America/Sao_Paulo              America/New_York               America/Sao_Paulo              

