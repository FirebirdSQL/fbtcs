create database "localhost:/home/asfernandes/fb/test/fbtcs/temp/winfunc.fdb";

create table persons (
  id integer generated by default as identity primary key,
  name varchar(15)
);

create table entries (
  id integer generated by default as identity primary key,
  person integer references persons,
  dat date,
  val numeric(10,2)
);

insert into persons (name) values ('Person 1');
insert into persons (name) values ('Person 2');
insert into persons (name) values ('Person 3');
insert into persons (name) values ('Person 4');
insert into persons (name) values ('Person 5');

insert into entries (person, dat, val) select id, date '2010-01-02' + id, id * 2 + 0.3 from persons;
insert into entries (person, dat, val) select id, date '2010-02-01' + id, id * 3 + 0.4 from persons;
insert into entries (person, dat, val) select id, date '2010-03-01' + id, id * 3 + 0.4 from persons;
insert into entries (person, dat, val) values (1, null, null);

select * from entries;

          ID       PERSON         DAT                   VAL 
============ ============ =========== ===================== 
           1            1 2010-01-03                   2.30 
           2            2 2010-01-04                   4.30 
           3            3 2010-01-05                   6.30 
           4            4 2010-01-06                   8.30 
           5            5 2010-01-07                  10.30 
           6            1 2010-02-02                   3.40 
           7            2 2010-02-03                   6.40 
           8            3 2010-02-04                   9.40 
           9            4 2010-02-05                  12.40 
          10            5 2010-02-06                  15.40 
          11            1 2010-03-02                   3.40 
          12            2 2010-03-03                   6.40 
          13            3 2010-03-04                   9.40 
          14            4 2010-03-05                  12.40 
          15            5 2010-03-06                  15.40 
          16            1      <null>                <null> 


---

select
    count(*), count(val), min(val), max(val),
    count(distinct val), min(distinct val), max(distinct val)
  from entries;

       COUNT        COUNT                   MIN                   MAX        COUNT                   MIN                   MAX 
============ ============ ===================== ===================== ============ ===================== ===================== 
          16           15                  2.30                 15.40           10                  2.30                 15.40 


select
    count(*) over (), count(val) over (), min(val) over (), max(val) over (),
    count(distinct val) over (), min(distinct val) over (), max(distinct val) over (),
    id
  from entries;

       COUNT        COUNT                   MIN                   MAX        COUNT                   MIN                   MAX           ID 
============ ============ ===================== ===================== ============ ===================== ===================== ============ 
          16           15                  2.30                 15.40           10                  2.30                 15.40            1 
          16           15                  2.30                 15.40           10                  2.30                 15.40            2 
          16           15                  2.30                 15.40           10                  2.30                 15.40            3 
          16           15                  2.30                 15.40           10                  2.30                 15.40            4 
          16           15                  2.30                 15.40           10                  2.30                 15.40            5 
          16           15                  2.30                 15.40           10                  2.30                 15.40            6 
          16           15                  2.30                 15.40           10                  2.30                 15.40            7 
          16           15                  2.30                 15.40           10                  2.30                 15.40            8 
          16           15                  2.30                 15.40           10                  2.30                 15.40            9 
          16           15                  2.30                 15.40           10                  2.30                 15.40           10 
          16           15                  2.30                 15.40           10                  2.30                 15.40           11 
          16           15                  2.30                 15.40           10                  2.30                 15.40           12 
          16           15                  2.30                 15.40           10                  2.30                 15.40           13 
          16           15                  2.30                 15.40           10                  2.30                 15.40           14 
          16           15                  2.30                 15.40           10                  2.30                 15.40           15 
          16           15                  2.30                 15.40           10                  2.30                 15.40           16 


---

select
    count(*), count(val), min(val), max(val),
    count(distinct val), min(distinct val), max(distinct val),
    person
  from entries
  group by person;

       COUNT        COUNT                   MIN                   MAX        COUNT                   MIN                   MAX       PERSON 
============ ============ ===================== ===================== ============ ===================== ===================== ============ 
           4            3                  2.30                  3.40            2                  2.30                  3.40            1 
           3            3                  4.30                  6.40            2                  4.30                  6.40            2 
           3            3                  6.30                  9.40            2                  6.30                  9.40            3 
           3            3                  8.30                 12.40            2                  8.30                 12.40            4 
           3            3                 10.30                 15.40            2                 10.30                 15.40            5 


select
    count(*) over (partition by person), count(val) over (partition by person),
    min(val) over (partition by person), max(val) over (partition by person),
    count(distinct val) over (partition by person), min(distinct val) over (partition by person),
    max(distinct val) over (partition by person),
    person
  from entries;

       COUNT        COUNT                   MIN                   MAX        COUNT                   MIN                   MAX       PERSON 
============ ============ ===================== ===================== ============ ===================== ===================== ============ 
           4            3                  2.30                  3.40            2                  2.30                  3.40            1 
           3            3                  4.30                  6.40            2                  4.30                  6.40            2 
           3            3                  6.30                  9.40            2                  6.30                  9.40            3 
           3            3                  8.30                 12.40            2                  8.30                 12.40            4 
           3            3                 10.30                 15.40            2                 10.30                 15.40            5 
           4            3                  2.30                  3.40            2                  2.30                  3.40            1 
           3            3                  4.30                  6.40            2                  4.30                  6.40            2 
           3            3                  6.30                  9.40            2                  6.30                  9.40            3 
           3            3                  8.30                 12.40            2                  8.30                 12.40            4 
           3            3                 10.30                 15.40            2                 10.30                 15.40            5 
           4            3                  2.30                  3.40            2                  2.30                  3.40            1 
           3            3                  4.30                  6.40            2                  4.30                  6.40            2 
           3            3                  6.30                  9.40            2                  6.30                  9.40            3 
           3            3                  8.30                 12.40            2                  8.30                 12.40            4 
           3            3                 10.30                 15.40            2                 10.30                 15.40            5 
           4            3                  2.30                  3.40            2                  2.30                  3.40            1 


---

select
    count(*), count(e.val), min(e.val), max(e.val),
    count(distinct e.val), min(distinct e.val), max(distinct e.val),
    p.name
  from entries e
  join persons p
    on p.id = e.person
  group by p.name;

       COUNT        COUNT                   MIN                   MAX        COUNT                   MIN                   MAX NAME            
============ ============ ===================== ===================== ============ ===================== ===================== =============== 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2        
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3        
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4        
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5        


select
    count(*) over (partition by p.id), count(e.val) over (partition by p.id),
    min(e.val) over (partition by p.id), max(e.val) over (partition by p.id),
    count(distinct e.val) over (partition by p.id), min(distinct e.val) over (partition by p.id),
    max(distinct e.val) over (partition by p.id),
    p.name
  from entries e
  join persons p
    on p.id = e.person;

       COUNT        COUNT                   MIN                   MAX        COUNT                   MIN                   MAX NAME            
============ ============ ===================== ===================== ============ ===================== ===================== =============== 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2        
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2        
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2        
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3        
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3        
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3        
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4        
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4        
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4        
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5        
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5        
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5        


---

select
    person,
    count(person) over (partition by person)
  from entries
  group by person;

      PERSON        COUNT 
============ ============ 
           1            1 
           2            1 
           3            1 
           4            1 
           5            1 


select
    person,
    count(*) over (partition by person)
  from entries
  group by person;

      PERSON        COUNT 
============ ============ 
           1            1 
           2            1 
           3            1 
           4            1 
           5            1 


---

create view v1 (x1, x2, x3, x4, x5, x6, x7, x8) as
  select
      count(*) over (partition by p.id), count(e.val) over (partition by p.id),
      min(e.val) over (partition by p.id), max(e.val) over (partition by p.id),
      count(distinct e.val) over (partition by p.id), min(distinct e.val) over (partition by p.id),
      max(distinct e.val) over (partition by p.id),
      p.name
    from entries e
    join persons p
      on p.id = e.person;

select * from v1;

          X1           X2                    X3                    X4           X5                    X6                    X7 X8              
============ ============ ===================== ===================== ============ ===================== ===================== =============== 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1        
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2        
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2        
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2        
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3        
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3        
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3        
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4        
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4        
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4        
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5        
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5        
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5        


select v1.*, p.id
  from persons p
  join v1
    on v1.x8 = p.name;

          X1           X2                    X3                    X4           X5                    X6                    X7 X8                        ID 
============ ============ ===================== ===================== ============ ===================== ===================== =============== ============ 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2                   2 
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2                   2 
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2                   2 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4                   4 
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4                   4 
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4                   4 
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5                   5 
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5                   5 
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5                   5 


select v1.*, p.id
  from persons p
  full join v1
    on right(v1.x8, 1) = p.id;

          X1           X2                    X3                    X4           X5                    X6                    X7 X8                        ID 
============ ============ ===================== ===================== ============ ===================== ===================== =============== ============ 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2                   2 
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2                   2 
           3            3                  4.30                  6.40            2                  4.30                  6.40 Person 2                   2 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4                   4 
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4                   4 
           3            3                  8.30                 12.40            2                  8.30                 12.40 Person 4                   4 
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5                   5 
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5                   5 
           3            3                 10.30                 15.40            2                 10.30                 15.40 Person 5                   5 


select v1.*, p.id
  from persons p
  left join v1
    on right(v1.x8, 1) = p.id
  where p.id in (1, 3);

          X1           X2                    X3                    X4           X5                    X6                    X7 X8                        ID 
============ ============ ===================== ===================== ============ ===================== ===================== =============== ============ 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           4            3                  2.30                  3.40            2                  2.30                  3.40 Person 1                   1 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 
           3            3                  6.30                  9.40            2                  6.30                  9.40 Person 3                   3 


select x3, sum(x4)
  from v1
  group by x3;

                   X3                   SUM 
===================== ===================== 
                 2.30                 13.60 
                 4.30                 19.20 
                 6.30                 28.20 
                 8.30                 37.20 
                10.30                 46.20 


select x3, sum(x4), count (*) over ()
  from v1
  group by x3;

                   X3                   SUM        COUNT 
===================== ===================== ============ 
                 2.30                 13.60            5 
                 4.30                 19.20            5 
                 6.30                 28.20            5 
                 8.30                 37.20            5 
                10.30                 46.20            5 


select x3, sum(x4), sum(sum(x4)) over ()
  from v1
  group by x3;

                   X3                   SUM                   SUM 
===================== ===================== ===================== 
                 2.30                 13.60                144.40 
                 4.30                 19.20                144.40 
                 6.30                 28.20                144.40 
                 8.30                 37.20                144.40 
                10.30                 46.20                144.40 


---

create view v2 as
  select *
    from entries;

select v2.person, sum(v2.val), count (*) over ()
  from v2
  join persons p
    on p.id = v2.person
  group by person;

      PERSON                   SUM        COUNT 
============ ===================== ============ 
           1                  9.10            5 
           2                 17.10            5 
           3                 25.10            5 
           4                 33.10            5 
           5                 41.10            5 


---

create view v3 as
  select v2.person, v2.val, p.name
    from v2
    join persons p
      on p.id = v2.person;

select v3.person, v3.name, sum(v3.val), count (*) over (), sum(sum(v3.val)) over ()
  from v3
  join persons p
    on p.id = v3.person
  group by person, name;

      PERSON NAME                              SUM        COUNT                   SUM 
============ =============== ===================== ============ ===================== 
           1 Person 1                         9.10            5                125.50 
           2 Person 2                        17.10            5                125.50 
           3 Person 3                        25.10            5                125.50 
           4 Person 4                        33.10            5                125.50 
           5 Person 5                        41.10            5                125.50 


---

select
    person,
    count(*) over (),
    count(*) over (partition by person)
  from entries;

      PERSON        COUNT        COUNT 
============ ============ ============ 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 
           1           16            4 


select
    person,
    count(*) over (),
    count(*) over (partition by person)
  from entries
  union all
select
    person,
    count(*) over (),
    count(*) over (partition by person)
  from entries;

      PERSON        COUNT        COUNT 
============ ============ ============ 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 
           1           16            4 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 

      PERSON        COUNT        COUNT 
============ ============ ============ 
           5           16            3 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 
           1           16            4 


---

select
    entries.*,
    count(*) over (partition by person || person)
  from entries;

          ID       PERSON         DAT                   VAL        COUNT 
============ ============ =========== ===================== ============ 
           1            1 2010-01-03                   2.30            4 
           2            2 2010-01-04                   4.30            3 
           3            3 2010-01-05                   6.30            3 
           4            4 2010-01-06                   8.30            3 
           5            5 2010-01-07                  10.30            3 
           6            1 2010-02-02                   3.40            4 
           7            2 2010-02-03                   6.40            3 
           8            3 2010-02-04                   9.40            3 
           9            4 2010-02-05                  12.40            3 
          10            5 2010-02-06                  15.40            3 
          11            1 2010-03-02                   3.40            4 
          12            2 2010-03-03                   6.40            3 
          13            3 2010-03-04                   9.40            3 
          14            4 2010-03-05                  12.40            3 
          15            5 2010-03-06                  15.40            3 
          16            1      <null>                <null>            4 


select
    entries.*,
    count(*) over (),
    count(val) over (),
    count(*) over (partition by person),
    count(val) over (partition by person),
    count(*) over (partition by dat),
    count(val) over (partition by dat)
  from entries;

          ID       PERSON         DAT                   VAL        COUNT        COUNT        COUNT        COUNT        COUNT        COUNT 
============ ============ =========== ===================== ============ ============ ============ ============ ============ ============ 
           1            1 2010-01-03                   2.30           16           15            4            3            1            1 
           2            2 2010-01-04                   4.30           16           15            3            3            1            1 
           3            3 2010-01-05                   6.30           16           15            3            3            1            1 
           4            4 2010-01-06                   8.30           16           15            3            3            1            1 
           5            5 2010-01-07                  10.30           16           15            3            3            1            1 
           6            1 2010-02-02                   3.40           16           15            4            3            1            1 
           7            2 2010-02-03                   6.40           16           15            3            3            1            1 
           8            3 2010-02-04                   9.40           16           15            3            3            1            1 
           9            4 2010-02-05                  12.40           16           15            3            3            1            1 
          10            5 2010-02-06                  15.40           16           15            3            3            1            1 
          11            1 2010-03-02                   3.40           16           15            4            3            1            1 
          12            2 2010-03-03                   6.40           16           15            3            3            1            1 
          13            3 2010-03-04                   9.40           16           15            3            3            1            1 
          14            4 2010-03-05                  12.40           16           15            3            3            1            1 
          15            5 2010-03-06                  15.40           16           15            3            3            1            1 
          16            1      <null>                <null>           16           15            4            3            1            0 


select
    entries.*,
    count(*) over (),
    count(val) over (),
    count(*) over (partition by person),
    count(val) over (partition by person),
    count(*) over (partition by extract(month from dat)),
    count(val) over (partition by extract(month from dat))
  from entries;

          ID       PERSON         DAT                   VAL        COUNT        COUNT        COUNT        COUNT        COUNT        COUNT 
============ ============ =========== ===================== ============ ============ ============ ============ ============ ============ 
           1            1 2010-01-03                   2.30           16           15            4            3            5            5 
           2            2 2010-01-04                   4.30           16           15            3            3            5            5 
           3            3 2010-01-05                   6.30           16           15            3            3            5            5 
           4            4 2010-01-06                   8.30           16           15            3            3            5            5 
           5            5 2010-01-07                  10.30           16           15            3            3            5            5 
           6            1 2010-02-02                   3.40           16           15            4            3            5            5 
           7            2 2010-02-03                   6.40           16           15            3            3            5            5 
           8            3 2010-02-04                   9.40           16           15            3            3            5            5 
           9            4 2010-02-05                  12.40           16           15            3            3            5            5 
          10            5 2010-02-06                  15.40           16           15            3            3            5            5 
          11            1 2010-03-02                   3.40           16           15            4            3            5            5 
          12            2 2010-03-03                   6.40           16           15            3            3            5            5 
          13            3 2010-03-04                   9.40           16           15            3            3            5            5 
          14            4 2010-03-05                  12.40           16           15            3            3            5            5 
          15            5 2010-03-06                  15.40           16           15            3            3            5            5 
          16            1      <null>                <null>           16           15            4            3            1            0 


select
    entries.*,
    min(dat) over (partition by person),
    max(dat) over (partition by person)
  from entries;

          ID       PERSON         DAT                   VAL         MIN         MAX 
============ ============ =========== ===================== =========== =========== 
           1            1 2010-01-03                   2.30 2010-01-03  2010-03-02  
           2            2 2010-01-04                   4.30 2010-01-04  2010-03-03  
           3            3 2010-01-05                   6.30 2010-01-05  2010-03-04  
           4            4 2010-01-06                   8.30 2010-01-06  2010-03-05  
           5            5 2010-01-07                  10.30 2010-01-07  2010-03-06  
           6            1 2010-02-02                   3.40 2010-01-03  2010-03-02  
           7            2 2010-02-03                   6.40 2010-01-04  2010-03-03  
           8            3 2010-02-04                   9.40 2010-01-05  2010-03-04  
           9            4 2010-02-05                  12.40 2010-01-06  2010-03-05  
          10            5 2010-02-06                  15.40 2010-01-07  2010-03-06  
          11            1 2010-03-02                   3.40 2010-01-03  2010-03-02  
          12            2 2010-03-03                   6.40 2010-01-04  2010-03-03  
          13            3 2010-03-04                   9.40 2010-01-05  2010-03-04  
          14            4 2010-03-05                  12.40 2010-01-06  2010-03-05  
          15            5 2010-03-06                  15.40 2010-01-07  2010-03-06  
          16            1      <null>                <null> 2010-01-03  2010-03-02  


select distinct
    person,
    min(dat) over (partition by person),
    max(dat) over (partition by person)
  from entries;

      PERSON         MIN         MAX 
============ =========== =========== 
           1 2010-01-03  2010-03-02  
           2 2010-01-04  2010-03-03  
           3 2010-01-05  2010-03-04  
           4 2010-01-06  2010-03-05  
           5 2010-01-07  2010-03-06  


select distinct
    person,
    count(*) over (),
    count(*) over (partition by person)
  from entries;

      PERSON        COUNT        COUNT 
============ ============ ============ 
           1           16            4 
           2           16            3 
           3           16            3 
           4           16            3 
           5           16            3 


select
    person,
    count(*),
    count(*) over (),
    count(*) over (partition by person),
    count(*) over (partition by 1, 2, 3)
  from entries
  group by person;

      PERSON        COUNT        COUNT        COUNT        COUNT 
============ ============ ============ ============ ============ 
           1            4            5            1            5 
           2            3            5            1            5 
           3            3            5            1            5 
           4            3            5            1            5 
           5            3            5            1            5 


select
    person,
    count(*),
    count(*) over (),
    count(*) over (partition by person),
    count(*) over (partition by 1, 2, 3)
  from entries
  group by person
  order by 1 desc;

      PERSON        COUNT        COUNT        COUNT        COUNT 
============ ============ ============ ============ ============ 
           5            3            5            1            5 
           4            3            5            1            5 
           3            3            5            1            5 
           2            3            5            1            5 
           1            4            5            1            5 


select *
  from (
    select
        person,
        count(*) c1,
        count(*) over () c2,
        count(*) over (partition by person) c3,
        count(*) over (partition by 1, 2, 3) c4
      from entries
      group by person
  )
  order by 1 desc;

      PERSON           C1           C2           C3           C4 
============ ============ ============ ============ ============ 
           5            3            5            1            5 
           4            3            5            1            5 
           3            3            5            1            5 
           2            3            5            1            5 
           1            4            5            1            5 


select
    person,
    count(*),
    count(*) over (),
    count(*) over (partition by person),
    count(*) over (partition by 1, 2, 3)
  from entries
  group by person
  order by 2 desc;

      PERSON        COUNT        COUNT        COUNT        COUNT 
============ ============ ============ ============ ============ 
           1            4            5            1            5 
           2            3            5            1            5 
           3            3            5            1            5 
           4            3            5            1            5 
           5            3            5            1            5 


select
    person,
    count(*),
    count(*) over (),
    count(*) over (partition by person),
    count(*) over (partition by 1, 2, 3),
    count(count(*)) over ()
  from entries
  group by person
  order by 3 desc, 1 desc;

      PERSON        COUNT        COUNT        COUNT        COUNT        COUNT 
============ ============ ============ ============ ============ ============ 
           5            3            5            1            5            5 
           4            3            5            1            5            5 
           3            3            5            1            5            5 
           2            3            5            1            5            5 
           1            4            5            1            5            5 


select
    person,
    count(*),
    count(*) over (),
    count(*) over (partition by person),
    count(*) over (partition by 1, 2, 3),
    count(count(*)) over ()
  from entries
  group by person
  having count(*) = 3
  order by 3 desc, 1 desc;

      PERSON        COUNT        COUNT        COUNT        COUNT        COUNT 
============ ============ ============ ============ ============ ============ 
           5            3            4            1            4            4 
           4            3            4            1            4            4 
           3            3            4            1            4            4 
           2            3            4            1            4            4 


select
    person,
    sum(val),
    count(*) over (),
    count(*) over (partition by person),
    count(*) over (partition by 1, 2, 3),
    count(count(*)) over ()
  from entries
  group by person
  order by 3 desc, 1 desc;

      PERSON                   SUM        COUNT        COUNT        COUNT        COUNT 
============ ===================== ============ ============ ============ ============ 
           5                 41.10            5            1            5            5 
           4                 33.10            5            1            5            5 
           3                 25.10            5            1            5            5 
           2                 17.10            5            1            5            5 
           1                  9.10            5            1            5            5 


select
    person,
    sum(val),
    count(*) over (),
    count(*) over (partition by person),
    count(*) over (partition by 1, 2, 3),
    count(count(*)) over ()
  from entries
  group by person
  having sum(val) between 16 and 26
  order by 3 desc, 1 desc;

      PERSON                   SUM        COUNT        COUNT        COUNT        COUNT 
============ ===================== ============ ============ ============ ============ 
           3                 25.10            2            1            2            2 
           2                 17.10            2            1            2            2 


---

-- Test invalid usages.

select
    person,
    sum(val) over (partition by count(*))
  from entries;
Statement failed, SQLSTATE = 42000
Dynamic SQL Error
-SQL error code = -104
-Invalid expression in the select list (not contained in either an aggregate function or the GROUP BY clause)
After line 313 in file fb_sql_window_func_01.sql

select
    person
  from entries
  where count(*) over () = 1;
Statement failed, SQLSTATE = 42000
Dynamic SQL Error
-SQL error code = -104
-Cannot use an aggregate or window function in a WHERE clause, use HAVING (for aggregate only) instead
After line 322 in file fb_sql_window_func_01.sql

select
    person
  from entries
  group by person
  having count(*) over () = 1;
Statement failed, SQLSTATE = 42000
Dynamic SQL Error
-SQL error code = -104
-Cannot use an aggregate or window function in a WHERE clause, use HAVING (for aggregate only) instead
After line 327 in file fb_sql_window_func_01.sql

---

exit;
