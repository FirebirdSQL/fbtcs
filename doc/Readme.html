<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<TITLE> New Document </TITLE>
<META NAME="Generator" CONTENT="EditPlus">
<META NAME="Author" CONTENT="">
<META NAME="Keywords" CONTENT="">
<META NAME="Description" CONTENT="">
</HEAD>

<BODY>
<H2>FBTCS Notes</H2>
<hr/>
First version: Oct 10 2003<br>
Last Update: Oct 10 2003<br>
Author: Blas Rodriguez Somoza <a href="">blas@puertareal.com</a><br>

<h3>0.-Introduction</h3>
<h3>1.-Contents</h3>
<p>The test suite is composed by tests, the tool to run it and several complementary files used to configure the tests</p>
<p>When you look for the first time inside this tool you will find the following directory structure:</p>
<ul>
<li>FBTCS
	<ul>
	<li>GTCS  (Platform independent test directory)</li>
		<ul>
		<li>meta-series (groups of series)</li>
		<li>series  (groups of tests)</li>
		<li>tests</li>
		</ul>
	<li>NT_LCTS  -> Win32 tests directory</li>
		<ul>
		<li>boilerplates (source included at the beggining of every test script)</li>
		<li>environments (symbol definitions for compilers and linkers)</li>
		<li>meta-series</li>
		<li>series</li>
		<li>tests</li>
		</ul>
	<li>SO_LTCS -> Solaris tests directory</li>
		<ul>
		<li>boilerplates</li>
		<li>environments</li>
		<li>meta-series</li>
		<li>series</li>
		<li>tests</li>
		</ul>
	<li>LI_LTCS -> Linux tests directory</li>
		<ul>
		<li>boilerplates</li>
		<li>environments</li>
		<li>meta-series</li>
		<li>series</li>
		<li>tests</li>
		</ul>
	<li>DOC -> Documents</li>
	<li>SRC -> Sources</li>
	<li>TEST-FILES -> Auxiliary files used by the tests</li>
	</ul>
</li>
</ul>

<p>Tests can be platform independent or platform dependent. Platform independent tests and configuration are in the directory GTCS and platform dependent tests are inside the NT_LTCS (win32), LI_LTCS (linux) and SO_LTCS (Solaris).</p>
<p>Configuration are platform and compiler dependent and are included only inside the platform dependent test directories</p>
<p>Each of the test directories contains a number of subdirectories which are the following:</p>
<ul>
<li>tests<br>
Here there are all the tests. This directory contains three file types, script, output and knownbug. The .script is the definition of the test, output is the reference output with which is compared the test output, and knownbug is the reference output if this test detect a known bug. If there is a known bug the test output is compared with the knownbug.</li>
<li>series<br>
Tests can be run as series and usually must be used this way, because some tests create the environment for following tests. This directory contains one file for each defined serie.</li>
<li>meta-series<br>
Test series can be grouped to create test meta-series. Each meta-series definition is contained in one file in this directory.</li>
<li>boilerplates(not in GTCS)<br>
The boilerplate is a file which is included at the beggining of the batch generated by the tool to run each test. It can contain paths, enviroment variables etc.</br>
<li>Environments(not in GTCS)<br>
In each environment there are information about meta symbols needed by the test to perform compilation, linking etc. Those symbols have not location or run dependency but are platform/tool dependent.There are two kinds of values in environments, [ve] give values to the dollar verbs and [te] are the templates for compilers and linkers.</li>
</ul>

<p>Outside the test directories, and in the bin directory created when the tool is built, there are two files more needed to run the tests,:</p>
<ul>
<li>tcs.config<br>
This file is used to give values to location/run dependent symbols that are used in the tests. This file also configures:<br>
<ul>
<li>platform independent directory (usually GTCS)
<li>platform dependent directory (f.i. NT_LTCS)
<li>boilerplate
<li>environment
</ul>
It is important to understand that the symbols defined here and those in environment are of different nature.
</li>
<li>runtcs.sh/.bat<br>
<dd>This is the script which run the tests. It creates the users/passwords needed by the tests and export the value of environment variables needed to define the location dependent symbols in tcs.config</li>
</ul>

<h3>2.-Build on MSVC</h3>
<p>To build the test tool suite the needed tools are</p>
<ul>
<li>Microsoft Visual Studio 6</li>
<li>sed unix command line utility</li>
</ul>
<p>To get a sed utility if you don't have one please see the README.build.msvc.html document in the engine doc directory</p>
<p>To build the tool switch to the src/tcs directory under the tool root directory and execute build_msvc6 batch</p>
<p>After the build is done, the needed files are copied to the bin directory under the tool root directory</p>

<h3>3.-Build on MinGW</h3>
<p>The needed tools are the same that for the MinGW engine build, excluding the parser, please see the README.build.mingw.html document in the engine doc directory.</p>
<p>The script to build the tool is in the src/tcs directory. The script is build_mingw.sh</p>
<p>After the build is done, the needed files are copied to the bin directory under the tool root directory</p>


<h3>4.-Running the tests</h3>
<p>After built the script file to run the suite is in the bin directory under the fbtcs root</p>
<p>Each time the tool is executed a test type and a test name should be included in the command line. Valid test types are:</p>
<ul>
<li>rt - one test</li>
<li>rs - test serie</li>
<li>rms - test meta serie</li>
</ul>
<p>the runtcs syntax are:</p>
<ul>
<li>runtcs test_type test_name [FIREBIRD root dir]</li>
</ul>
<p>The FIREBIRD argument is only needed if the FIREBIRD environment variable is not set.</p>
<p>The tool produces to kind of outputs<p>
<ul>
<li>To the stdout the tests names and the final results.</li>
<li>To the output directory two/three files for each test (if tcs have the -s option) :</li>
<ul>
<li>.out - This is the real output of the test run</li>
<li>.cmp - This is the valid output stored in the tests directory, the real output should be equal to this one</li>
<li>.diff - If there is any difference between the valid and the real output it will be write in this file.</li>
</ul>
</ul>
<p>If the -s option is not set the files generated with the test will be deleted immediately after the test run, unless the test fails.</p>

<h3>5.- Series and meta-series configuration.</h3>
<p>Inside the series and meta-series directories there are definition files with the foloowing format</p>
<p>[#][test|serie] sequence</p>
<p>If the # is present in the first position the test or serie will be no run.</p>

<h3>6.- Tests definition</h3>
<p>For each test two files shold exists, the tests definition and the reference output.</p>
<p>The test definition contains a sequence of script verbs. The script verbs are the following:</p>
<blockquote>
<table border="1" cellpadding="3">
<tr>
<td>Verb</td>
<td>Description</td>
<td>Default<br>command</td>
<td>filename<br>handling</td>
<tr>
<td>ADA</td>
<td>Invokes ada compiler</td>
<td>-</td>
<td>fix_compile</td>
</tr>
<tr>
<td>ADA_LINK</td>
<td>Invokes ada linker</li>
<td>-</td>
<td>fix_link</td>
</tr>
<tr>
<td>ADA_MKFAM</td>
<td>Invokes ada family manager to create a family</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>ADA_MKLIB</td>
<td>Creates an ada library</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>ADA_RMFAM</td>
<td>Invokes ada family manager to remove a family</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>ADA_RMLIB</td>
<td>Removes an ada library</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>ADA_SEARCH</td>
<td>¿?</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>ADA_SETLIB</td>
<td>¿?</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>CC</td>
<td>C Compile</td>
<td>-</td>
<td>fix_cc</td>
</tr>
<tr>
<td>CXX</td>
<td>C++ compile</td>
<td>-</td>
<td>fix_cxx</td>
</tr>
<tr>
<td>COBOL</td>
<td>Invokes cobol compiler</td>
<td>-</td>
<td>fix_compile</td>
</tr>
<tr>
<td>COB_LINK</td>
<td>Invokes cobol linker</td>
<td>-</td>
<td>fix_link</td>
</tr>
<tr>
<td>COPY</td>
<td>copy a file</td>
<td>copy_file</td>
<td>fix_isc</td>
</tr>
<tr>
<td>CREATE</td>
<td>create a from the following lines in the script until the next dollar verb.</td>
<td>create_file > </td>
<td>fix_isc</td>
</tr>
<tr>
<td>DELETE</td>
<td>delete a local file</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>DELETE_REM</td>
<td>delete a remote file</td>
<td>delete_file</td>
<td>fix_isc</td>
</tr>
<tr>
<td>DROP</td>
<td>drop database</td>
<td>drop_gdb</td>
<td>fix_isc</td>
</tr>
<tr>
<td>FORTRAN</td>
<td>Invokes fortran compiler</td>
<td>-</td>
<td>fix_compile</td>
</tr>
<tr>
<td>GBAK</td>
<td>invoke gbak</td>
<td>gbak</td>
<td>fix_isc</td>
</tr>
<tr>
<td>GDEF</td>
<td>invoke gdef</td>
<td>gdef</td>
<td>fix_isc</td>
</tr>
<tr>
<td>GFIX</td>
<td>invoke gfix</td>
<td>gfix</td>
<td>fix_isc</td>
</tr>
<tr>
<td>GJRN</td>
<td>invoke gjrn</td>
<td>gjrn</td>
<td>fix_isc</td>
</tr>
<tr>
<td>GPRE</td>
<td>invoke gpre</td>
<td>gpre</td>
<td>fix_isc</td>
</tr>
<tr>
<td>GSEC</td>
<td>invoke gsec</td>
<td>gsec</td>
<td>fix_isc</td>
</tr>
<tr>
<td>ISQL</td>
<td>invoke isql</td>
<td>isql</td>
<td>fix_isc</td>
</tr>
<tr>
<td>JAVA</td>
<td>run a java program</td>
<td>-</td>
<td>fix_compile</td>
</tr>
<tr>
<td>JAVAC</td>
<td>compile a java program</td>
<td>-</td>
<td>fix_compile</td>
</tr>
<tr>
<td>LINK</td>
<td>Invokes linker</td>
<td>-</td>
<td>fix_link</td>
</tr>
<tr>
<td>MAKE</td>
<td>Invokes platform make</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>PASCAL</td>
<td>Invokes pascal compiler</td>
<td>-</td>
<td>fix_compile</td>
</tr>
<tr>
<td>QLI</td>
<td>invokes qli</td>
<td>qli</td>
<td>fix_isc</td>
</tr>
<tr>
<td>RUN</td>
<td>invoke the program</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>RUN_BG</td>
<td>invoke the program</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>SH</td>
<td>invoke the program in a new shell</td>
<td>-</td>
<td>fix_isc</td>
</tr>
<tr>
<td>SLEEP</td>
<td>Sleep for parm1 seconds</td>
<td>sleep_sec</td>
<td>fix_isc</td>
</tr>
<tr>
<td>TYPE</td>
<td>Type a file to output</td>
<td>create file</td>
<td>fix_isc</td>
</tr>
</table>
</blockquote>

<p>And some symbols that will be processed by the tool to make a valid platform script</p>
<p>An example of  location dependent symbols and its values as defined in tcs.config are the following</p>
<ul>
<li>WHERE_GDB=localhost:$(TCS:FBTCS)/temp/</li>
<li>WHERE_GDB_EXTERNAL=$(TCS:FBTCS)/temp/</li>
<li>WHERE_EXAMPLES=$(TCS:FIREBIRD)/udf/</li>
<li>WHERE_FILES=$(TCS:FBTCS)/test-files/</li>
<li>WHERE_FIREBIRD_INCLUDE=$(TCS:FIREBIRD)/include/</li>
<li>WHERE_FIREBIRD_LIB=$(TCS:FIREBIRD)/lib/</li>
<li>WHERE_FBTCS_INCLUDE=$(TCS:FBTCS)/src/tcs/</li>
</ul>
<p>There are a special use of those symbols which are needed for some tests. If the symbol is followed in the script or reference output by (PLATFORM_UPPER) the value of the symbol will be converted to uppercase and with platform dependent path separator. For instance if the value of symbol SYMBOL1 is:<br><br>
/dir1/file<br><br>
then SYMBOL:(PLATFORM_UPPER) in win32 will be transformed to<br><br>
\DIR1\FILE<br><br>
This tranformation is needed in the EXT_LEV_0 series.
</p>


<p>The pattern $(TCS:<envvar>) will be replaced by the tool with the value of the environment variable, this pattern is only valid in tcs.config file.</p>
<p>As an example, the used platform/tool dependent symbols as defined in the msvc6 enviroment for the win32 platform are the following:</p>
<ul>
<li>FLAG_CC -c -w /D "WIN_NT" %s /I WHERE_FIREBIRD_INCLUDE: /I WHERE_FBTCS_INCLUDE: /nologo > nul</li>
<li>FLAG_CXX -c -w /D "WIN_NT" %s /I WHERE_FIREBIRD_INCLUDE: /I WHERE_FBTCS_INCLUDE: /nologo > nul</li>
<li>FLAG_LINK %s msvcrt.lib kernel32.lib WHERE_FIREBIRD_LIB:gds32_ms.lib /OUT:%s.exe /NODEFAULTLIB /NOLOGO</li>
</ul>
<p>All the tests, enviroments and boilerplates files are processed before anything else to replace location dependent symbols with its values, but only test files are processed with the tool/platform dependent symbols.</p>
<p>As can be noted the platform/tool dependent macros contains one or more "%s" literals. When the script processor locates a platform/tool symbol, it takes the arguments following it and use the symbol as a format specifier. For instance when processing the link </p>
</BODY>
</HTML>
